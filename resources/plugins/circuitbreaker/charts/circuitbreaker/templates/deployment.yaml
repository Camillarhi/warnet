apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ .Values.podName }}
spec:
  replicas: 1
  selector:
    matchLabels:
      app: circuitbreaker
  template:
    metadata:
      labels:
        app: circuitbreaker
    spec:
      containers:
      - name: circuitbreaker
        image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
        args:
        - "--rpcserver={{ .Values.rpcserver }}"
        - "--httplisten={{ .Values.httplisten }}"
        ports:
        - containerPort: 9235
        volumeMounts:
        - name: lnd-tls-cert
          mountPath: /root/.lnd/tls.cert
          subPath: tls.cert
        - name: lnd-macaroon
          mountPath: /root/.lnd/data/chain/bitcoin/regtest/admin.macaroon
          subPath: admin.macaroon
      volumes:
      - name: lnd-tls-cert
        secret:
          secretName: lnd-tls-cert-{{ .Values.podName }}
      - name: lnd-macaroon
        secret:
          secretName: lnd-macaroon-{{ .Values.podName }}